{{left_sidebar_enabled,right_sidebar_enabled=False,False}}
{{response.title = "Study Editor"}}
{{response.subtitle = "study (id:%s)" % request.args[0]}}

{{### Add support scripts for single-page editor 

# JSON support for older browsers (esp. IE7) 
response.files.append(URL('static','js/json2.js'))

# Knockout.js for binding JSON model to editing UI 
response.files.append(URL('static','js/knockout-2.3.0.js'))

# Knockout plugin for easy declarative mapping 
response.files.append(URL('static','js/knockout.mapping-2.4.1.js'))

# Knockout bindings for Twitter Bootstrap components
response.files.append(URL('static','js/knockout-bootstrap.min.js'))
}}

{{extend 'layout.html'}}

<div class="row">
    <div class="span8"><!-- not too wide... -->
       {{if 'message' in globals():}}
        <h4>{{=message}}</h4>
       {{pass}}

        <div class="">

            <div class="navbar">
              <div class="navbar-inner">
                <ul class="nav">
                  <li><a href="#">Import</a></li>
                  <li class="active"><a href="#">Metadata</a></li>
                  <li><a href="#">Trees</a></li>
                  <li><a href="#">Files</a></li>
                  <li><a href="#">Mapping</a></li>
                  <li><a href="#">Status</a></li>
                </ul>
              </div>
            </div>

            <div id="ajax-busy-bar" class="progress progress-striped active">
              <div class="bar" style="width: 100%;"></div>
            </div>

            <h2>Study metadata</h2>
            <form class="form-horizontal wider-fields">
              <div class="control-group">
                <label class="control-label" for="ot_studyPublicationReference">Publication reference</label>
                <div class="controls">
                  <textarea data-bind="value: getMetaTagAccessorByAtProperty(nexml.meta(), 'ot:studyPublicationReference'), valueUpdate: 'afterkeydown'" id="ot_studyPublicationReference" class="input-xlarge" style="height: 160px;" placeholder=""></textarea>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="ot_studyPublication">Publication</label>
                <div class="controls">
                  <input data-bind="value: getMetaTagAccessorByAtProperty(nexml.meta(), 'ot:studyPublication'), valueUpdate: 'afterkeydown'" type="text" id="ot_studyPublication" class="input-xlarge" placeholder="">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="ot_studyYear">Study Year</label>
                <div class="controls">
                  <input data-bind="value: getMetaTagAccessorByAtProperty(nexml.meta(), 'ot:studyYear'), valueUpdate: 'afterkeydown'" type="text" id="ot_studyYear" class="input-mini" placeholder="">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="ot_studyId">Study ID</label>
                <div class="controls">
                  <input data-bind="value: getMetaTagAccessorByAtProperty(nexml.meta(), 'ot:studyId'), valueUpdate: 'afterkeydown'" type="text" id="ot_studyId" class="input-small" placeholder="">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="ot_focalClade">Focal clade</label>
                <div class="controls">
                  <input data-bind="value: getMetaTagAccessorByAtProperty(nexml.meta(), 'ot:focalClade'), valueUpdate: 'afterkeydown'" type="text" id="ot_focalClade" class="input-small" placeholder="">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="ot_curatorName">Curator name</label>
                <div class="controls">
                  <input data-bind="value: getMetaTagAccessorByAtProperty(nexml.meta(), 'ot:curatorName'), valueUpdate: 'afterkeydown'" type="text" id="ot_curatorName" class="input-xlarge" placeholder="">
                </div>
              </div>

              <div class="control-group">
                <div class="controls">
                  <label class="checkbox">
                    <input type="checkbox"> This study has no rooted trees. (This is not typical.)
                  </label>
                  <label class="checkbox">
                    <input type="checkbox"> This study should not contribute to synthesis.
                  </label>
                  <!--
                  <button type="submit" class="btn">Sign in</button>
                  -->
                </div>
              </div>

              <i>nexml.meta (remapped for return to server)</i>
              <pre data-bind="visible: nexml.meta, text: ko.mapping.toJSON(nexml.meta)" style="color: #933; font-size: small; width: 100%; height: 500px; overflow: auto;">
              </pre>

            </form>

            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
        </div>

    </div><!-- end of main col -->

    <div class="span4">
        <div class="Xbtn-group">
              <button class="btn btn"
                      onclick="if (validateFormData()) saveFormDataToStudyJSON(); return false;">Save Study</button>
              <button class="btn btn-link">Cancel</button>
              <button class="btn btn-danger pull-right"
                      onclick="confirm('Are you sure you want to delete this study?'); return false;">Delete Study</button>
        </div>

        <div style="margin-top: 20px;">
            <strong>Study quality</strong> <a href="#">(hide details)</a>
            
            <div data-bind="css: studyQualityBarClass">
              <div class="bar" data-bind="style: { width: studyQualityPercentStyle }">
                  <span data-bind="text: studyQualityPercent"></span>%
              </div>
            </div>
        </div>

        <div Xclass="well well-large" style="margin-top: 20px;">
            <strong>Suggested next steps</strong>
            <ol id="suggested-actions" style="margin-left: 20px;">
                <li><a href="#">Root default tree (5%)</a></li>
                <li><a href="#">Map retaining taxon names (15%)</a></li>
                <li><a href="#">Add supporting files (5%)</a></li>
            </ol>
        </div>
    </div><!-- end of right col -->

</div><!-- /.row -->

<script type='text/javascript'>
    var studyID = '{{= request.args[0] }}';
    var authorName = '{{= auth.user.name }}';
    var authorEmail = '{{= auth.user.email }}';
    var authToken = '{{= auth.user.github_auth_token }}';
    var API_create_study_POST_url = '{{= conf.get("apis", "API_create_study_POST_url") }}';
    var API_load_study_GET_url = '{{= conf.get("apis", "API_load_study_GET_url") }}';
    var API_update_study_PUT_url = '{{= conf.get("apis", "API_update_study_PUT_url") }}';
</script>
<script src="{{=URL('static','js/study-editor.js')}}"></script>
